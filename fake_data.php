<?php
//displays errors
error_reporting(E_ALL);
ini_set('display_errors', 1);

//database connection
$servername = "localhost";
$username = "root";
$password = "mysql"; // Default for AMMPS
$dbname = "campus_tracker";

$conn = new mysqli($servername, $username, $password, $dbname);
if ($conn->connect_error) die("Connection failed: " . $conn->connect_error);

//set the timezone
//define the timezone
date_default_timezone_set('America/New_York');
// Algorithm: vary traffic by hour and location
$hour = date("G"); //represents the current hour 0-23
$day = date("w"); //represents the current day Sunday=0 Monday=1 etc. 

//will print what time and day the computer thinks it is
//echo "Server time: " . date("Y-m-d H:i:s") . " (hour=$hour, day=$day)<br>";

//list of locations as well as max capacity 
//this also includes the stay duration ranges 
$locations = [
  1 =>["name" =>"cafeteria", "capacity" => 250, "stay" => [20,60]],
  2 =>["name" =>"north_tower_gym", "capacity" => 75 , "stay" => [30,90]],
  3 =>["name" =>"subway", "capacity" => 30 , "stay" => [5,20] ]
];



//arrival rates for each major hour which accounts for different lunch rush hours based on the day
$arrivalRates = [
  //cafeteria arrival rates
    "cafeteria" => [
        // Mon - Fri
        1 => [ // Monday
            "7:15" => [5, 10], "7:30"=>[5,10], "7:45"=>[5,10], "8:00"=>[10,20], "8:15"=>[10,20], "8:30"=>[10,20], "8:45"=>[10,20],"9:00"=>[5,10], "9:15"=>[5,10], //Breakfast
            "9:30" => [2,7], "10:30" => [2,5], //Continental Breakfast
            "11:00"=>[50, 80], "11:15"=>[50,80], "11:30"=>[60,90], "11:45"=>[60,90], "12:00"=>[70,100], "12:15"=>[70,100], "12:30"=>[50,80], "12:45"=>[50,80], "13:00"=>[40,70], "13:15"=>[40,70], "13:30"=>[20,40], "13:45"=>[20,40], // Lunch + Lite Lunch
            "16:00"=>[40,80], "16:15"=>[40,80], "16:30"=>[40,80], "16:45"=>[30,70], "17:00"=>[30,70], "17:15"=>[30,70], "17:30"=>[30,70], "17:45"=>[20,50], "18:00"=>[20,50], "18:15"=>[20,50], "18:30"=>[10,40], "18:45"=>[10,40] // Dinner
        ],
        2 => [ // Tuesday - lunch rush shifted 12:15-1:30
            "7:15" => [5, 10], "7:30"=>[5,10], "7:45"=>[5,10], "8:00"=>[10,20], "8:15"=>[10,20], "8:30"=>[10,20], "8:45"=>[10,20],
            "9:00"=>[5,10], "9:15"=>[5,10],//Breakfast
            "9:30" => [2,7], "10:30" => [2,5], //Continental Breakfast
            "12:15"=>[50,80], "12:30"=>[60,90], "12:45"=>[60,90], "13:00"=>[50,80], "13:15"=>[40,70], "13:30"=>[30,60], // lunch rush
            "16:00"=>[40,80], "16:15"=>[40,80], "16:30"=>[30,70], "16:45"=>[30,70], "17:00"=>[20,50], "17:15"=>[20,50], "17:30"=>[10,40], "17:45"=>[10,40]
        ],
        3 => [ // Wednesday same as Monday
            "7:15"=>[5,10], "7:30"=>[5,10], "7:45"=>[5,10], "8:00"=>[10,20], "8:15"=>[10,20], "8:30"=>[10,20], "8:45"=>[10,20],
            "9:00"=>[5,10], "9:15"=>[5,10], "9:30" => [2,7], "10:30" => [2,5], //Continental Breakfast
            "11:00"=>[50, 80], "11:15"=>[50,80], "11:30"=>[60,90], "11:45"=>[60,90], "12:00"=>[70,100], "12:15"=>[70,100], "12:30"=>[50,80], "12:45"=>[50,80], "13:00"=>[40,70], "13:15"=>[40,70], "13:30"=>[20,40], "13:45"=>[20,40],
            "16:00"=>[40,80], "16:15"=>[40,80], "16:30"=>[30,70], "16:45"=>[30,70], "17:00"=>[30,70], "17:15"=>[20,50], "17:30"=>[20,50], "17:45"=>[10,40], "18:00"=>[10,40]
        ],
        4 => [ // Thursday same as Tuesday
            "7:15"=>[5,10], "7:30"=>[5,10], "7:45"=>[5,10], "8:00"=>[10,20], "8:15"=>[10,20], "8:30"=>[10,20], "8:45"=>[10,20],
            "9:00"=>[5,10], "9:15"=>[5,10], "9:30" => [2,7], "10:30" => [2,5], //Continental Breakfast
            //lunch rush hour here
            "12:15"=>[50,80], "12:30"=>[60,90], "12:45"=>[60,90], "13:00"=>[50,80], "13:15"=>[40,70], "13:30"=>[30,60],
            "16:00"=>[40,80], "16:15"=>[40,80], "16:30"=>[30,70], "16:45"=>[30,70], "17:00"=>[20,50], "17:15"=>[20,50], "17:30"=>[10,40], "17:45"=>[10,40]
        ],
        5 => [ // Friday
            "7:15"=>[5,10], "7:30"=>[5,10], "7:45"=>[5,10], "8:00"=>[10,20], "8:15"=>[10,20], "8:30"=>[10,20], "8:45"=>[10,20],
            "9:00"=>[5,10], "9:15"=>[5,10], "9:30" => [2,7], "10:30" => [2,5], //Continental Breakfast
            "11:00"=>[30,50], "11:15"=>[30,50], "11:30"=>[40,60], "11:45"=>[40,60], "12:00"=>[30,50], "12:15"=>[30,50], "12:30"=>[20,40], "12:45"=>[20,40],
            "16:00"=>[30,60], "16:15"=>[30,60], "16:30"=>[20,50], "16:45"=>[20,50], "17:00"=>[10,40], "17:15"=>[10,40], "17:30"=>[5,20], "17:45"=>[5,20]
        ],
        6 => [ // Saturday
            "10:30"=>[10,20], "10:45"=>[8,15], "11:00"=>[5,10], "11:15"=>[5,10], "11:30"=>[5,10], "11:45"=>[3,8],
            "16:00"=>[10,20], "16:15"=>[8,15], "16:30"=>[5,10]
        ],
        0 => [ // Sunday
            "10:30"=>[5,15], "10:45"=>[3,10], "11:00"=>[3,8], "11:15"=>[3,8], "11:30"=>[3,8], "11:45"=>[2,5],
            "16:00"=>[5,15], "16:15"=>[3,10], "16:30"=>[3,8]
        ]
    ],
    "subway" => [
        1 => [ // Monday
        "07:30"=>[0,5], "07:45"=>[0,5], "08:00"=>[0,5], "08:15"=>[0,5], "08:30"=>[0,5], "08:45"=>[0,5], // Slow Mornings
        "09:00"=>[0,10], "09:15"=>[0,4], "09:30"=>[0,5], "09:45"=>[0,8],
        "10:00"=>[5,10], "10:15"=>[5,10], "10:30"=>[5,10], "10:45"=>[5,10],
        "11:00"=>[10,15], "11:15"=>[10,15], "11:30"=>[10,15], "11:45"=>[10,15],
        "12:00"=>[15,25], "12:15"=>[15,25], "12:30"=>[15,25], "12:45"=>[15,25], // Lunch
        "13:00"=>[10,20], "13:15"=>[10,20], "13:30"=>[10,20], "13:45"=>[10,20],
        "14:00"=>[5,15], "14:15"=>[5,15], "14:30"=>[5,15], "14:45"=>[5,15],
        "15:00"=>[5,15], "15:15"=>[5,15], "15:30"=>[5,15], "15:45"=>[5,15],
        "16:00"=>[10,15], "16:15"=>[10,15], "16:30"=>[10,15], "16:45"=>[10,15], // Evening rush
        "17:00"=>[15,20], "17:15"=>[15,20], "17:30"=>[15,20], "17:45"=>[15,20],
        "18:00"=>[15,20], "18:15"=>[15,20], "18:30"=>[15,20], "18:45"=>[10,20],
        "19:00"=>[10,20], "19:15"=>[5,15], "19:30"=>[5,10], "19:45"=>[5,10],
        "20:00"=>[5,10], "20:15"=>[5,10], "20:30"=>[5,10], "20:45"=>[5,10],
        "21:00"=>[5,10], "21:15"=>[5,10], "21:30"=>[5,10], "21:45"=>[0,10],
        "22:00"=>[0,10], "22:15"=>[0,10], "22:30"=>[0,10]
        ],

        //Tuesday
        2 => ["07:30"=>[0,5], "07:45"=>[0,5], "08:00"=>[0,5], "08:15"=>[0,5], "08:30"=>[0,5], "08:45"=>[0,5], // Slow Mornings
        "09:00"=>[0,10], "09:15"=>[0,4], "09:30"=>[0,5], "09:45"=>[0,8],
        "10:00"=>[5,10], "10:15"=>[5,10], "10:30"=>[5,10], "10:45"=>[5,10],
        "11:00"=>[10,15], "11:15"=>[10,15], "11:30"=>[10,15], "11:45"=>[10,15],
        "12:00"=>[15,25], "12:15"=>[15,25], "12:30"=>[15,25], "12:45"=>[15,25], // Lunch
        "13:00"=>[10,20], "13:15"=>[10,20], "13:30"=>[10,20], "13:45"=>[10,20],
        "14:00"=>[5,15], "14:15"=>[5,15], "14:30"=>[5,15], "14:45"=>[5,15],
        "15:00"=>[5,15], "15:15"=>[5,15], "15:30"=>[5,15], "15:45"=>[5,15],
        "16:00"=>[10,15], "16:15"=>[10,15], "16:30"=>[10,15], "16:45"=>[10,15], // Evening rush
        "17:00"=>[15,20], "17:15"=>[15,20], "17:30"=>[15,20], "17:45"=>[15,20],
        "18:00"=>[15,20], "18:15"=>[15,20], "18:30"=>[15,20], "18:45"=>[10,20],
        "19:00"=>[10,20], "19:15"=>[5,15], "19:30"=>[5,10], "19:45"=>[5,10],
        "20:00"=>[5,10], "20:15"=>[5,10], "20:30"=>[5,10], "20:45"=>[5,10],
        "21:00"=>[5,10], "21:15"=>[5,10], "21:30"=>[5,10], "21:45"=>[0,10],
        "22:00"=>[0,10], "22:15"=>[0,10], "22:30"=>[0,10]], 

      //Wednesday
        3 => ["07:30"=>[0,5], "07:45"=>[0,5], "08:00"=>[0,5], "08:15"=>[0,5], "08:30"=>[0,5], "08:45"=>[0,5], // Slow Mornings
        "09:00"=>[0,10], "09:15"=>[0,4], "09:30"=>[0,5], "09:45"=>[0,8],
        "10:00"=>[5,10], "10:15"=>[5,10], "10:30"=>[5,10], "10:45"=>[5,10],
        "11:00"=>[10,15], "11:15"=>[10,15], "11:30"=>[10,15], "11:45"=>[10,15],
        "12:00"=>[15,25], "12:15"=>[15,25], "12:30"=>[15,25], "12:45"=>[15,25], // Lunch
        "13:00"=>[10,20], "13:15"=>[10,20], "13:30"=>[10,20], "13:45"=>[10,20],
        "14:00"=>[5,15], "14:15"=>[5,15], "14:30"=>[5,15], "14:45"=>[5,15],
        "15:00"=>[5,15], "15:15"=>[5,15], "15:30"=>[5,15], "15:45"=>[5,15],
        "16:00"=>[10,15], "16:15"=>[10,15], "16:30"=>[10,15], "16:45"=>[10,15], // Evening rush
        "17:00"=>[15,20], "17:15"=>[15,20], "17:30"=>[15,20], "17:45"=>[15,20],
        "18:00"=>[15,20], "18:15"=>[15,20], "18:30"=>[15,20], "18:45"=>[10,20],
        "19:00"=>[10,20], "19:15"=>[5,15], "19:30"=>[5,10], "19:45"=>[5,10],
        "20:00"=>[5,10], "20:15"=>[5,10], "20:30"=>[5,10], "20:45"=>[5,10],
        "21:00"=>[5,10], "21:15"=>[5,10], "21:30"=>[5,10], "21:45"=>[0,10],
        "22:00"=>[0,10], "22:15"=>[0,10], "22:30"=>[0,10]], 
      //Thursday
        4 => ["07:30"=>[0,5], "07:45"=>[0,5], "08:00"=>[0,5], "08:15"=>[0,5], "08:30"=>[0,5], "08:45"=>[0,5], // Slow Mornings
        "09:00"=>[0,10], "09:15"=>[0,4], "09:30"=>[0,5], "09:45"=>[0,8],
        "10:00"=>[5,10], "10:15"=>[5,10], "10:30"=>[5,10], "10:45"=>[5,10],
        "11:00"=>[10,15], "11:15"=>[10,15], "11:30"=>[10,15], "11:45"=>[10,15],
        "12:00"=>[15,25], "12:15"=>[15,25], "12:30"=>[15,25], "12:45"=>[15,25], // Lunch
        "13:00"=>[10,20], "13:15"=>[10,20], "13:30"=>[10,20], "13:45"=>[10,20],
        "14:00"=>[5,15], "14:15"=>[5,15], "14:30"=>[5,15], "14:45"=>[5,15],
        "15:00"=>[5,15], "15:15"=>[5,15], "15:30"=>[5,15], "15:45"=>[5,15],
        "16:00"=>[10,15], "16:15"=>[10,15], "16:30"=>[10,15], "16:45"=>[10,15], // Evening rush
        "17:00"=>[15,20], "17:15"=>[15,20], "17:30"=>[15,20], "17:45"=>[15,20],
        "18:00"=>[15,20], "18:15"=>[15,20], "18:30"=>[15,20], "18:45"=>[10,20],
        "19:00"=>[10,20], "19:15"=>[5,15], "19:30"=>[5,10], "19:45"=>[5,10],
        "20:00"=>[5,10], "20:15"=>[5,10], "20:30"=>[5,10], "20:45"=>[5,10],
        "21:00"=>[5,10], "21:15"=>[5,10], "21:30"=>[5,10], "21:45"=>[0,10],
        "22:00"=>[0,10], "22:15"=>[0,10], "22:30"=>[0,10]], 

        //Friday
        5 => ["07:30"=>[0,5], "07:45"=>[0,5], "08:00"=>[0,5], "08:15"=>[0,5], "08:30"=>[0,5], "08:45"=>[0,5], // Slow Mornings
        "09:00"=>[0,10], "09:15"=>[0,4], "09:30"=>[0,5], "09:45"=>[0,8],
        "10:00"=>[5,10], "10:15"=>[5,10], "10:30"=>[5,10], "10:45"=>[5,10],
        "11:00"=>[10,15], "11:15"=>[10,15], "11:30"=>[10,15], "11:45"=>[10,15],
        "12:00"=>[15,25], "12:15"=>[15,25], "12:30"=>[15,25], "12:45"=>[15,25], // Lunch
        "13:00"=>[10,20], "13:15"=>[10,20], "13:30"=>[10,20], "13:45"=>[10,20],
        "14:00"=>[5,15], "14:15"=>[5,15], "14:30"=>[5,15], "14:45"=>[5,15],
        "15:00"=>[5,15], "15:15"=>[5,15], "15:30"=>[5,15], "15:45"=>[5,15],
        "16:00"=>[10,15], "16:15"=>[10,15], "16:30"=>[10,15], "16:45"=>[10,15], // Evening rush
        "17:00"=>[15,20], "17:15"=>[15,20], "17:30"=>[15,20], "17:45"=>[15,20],
        "18:00"=>[15,20], "18:15"=>[15,20], "18:30"=>[15,20], "18:45"=>[10,20],
        "19:00"=>[10,20], "19:15"=>[5,15], "19:30"=>[5,10], "19:45"=>[5,10],
        "20:00"=>[5,10], "20:15"=>[5,10], "20:30"=>[5,10], "20:45"=>[5,10],
        "21:00"=>[5,10], "21:15"=>[5,10], "21:30"=>[5,10], "21:45"=>[0,10],
        "22:00"=>[0,10], "22:15"=>[0,10], "22:30"=>[0,10]]  
        
        //Saturday and Sunday
        6 => ["17:00"=>[5,15], "17:15"=>[3,10], "17:30"=>[3,10], "17:45"=>[3,10]],
        0 => ["17:00"=>[5,15], "17:15"=>[3,10], "17:30"=>[3,10], "17:45"=>[3,10]]
    ],
    "north_tower_gym" => [
          1 => ["8:00"=>[5,10], "17:00"=>[10,20], "18:00"=>[10,15], "19:00"=>[5,10]], // Monday
          2 => ["8:00"=>[5,10], "17:00"=>[10,20], "18:00"=>[10,15], "19:00"=>[5,10], "23:00"=>[0,3]], // Tuesday until midnight
          3 => ["8:00"=>[5,10], "17:00"=>[10,20], "18:00"=>[10,15], "19:00"=>[5,10]], // Wednesday
          4 => ["8:00"=>[5,10], "17:00"=>[10,20], "18:00"=>[10,15], "19:00"=>[5,10], "23:00"=>[0,3]], // Thursday until midnight
          5 => ["14:00"=>[5,10], "17:00"=>[10,20]], // Friday 2pm-8pm
          6 => ["14:00"=>[5,10], "15:00"=>[5,10], "16:00"=>[5,10], "17:00"=>[5,10], "18:00"=>[3,8]], // Saturday
          0 => ["16:00"=>[5,10], "17:00"=>[5,10], "18:00"=>[3,8], "19:00"=>[3,8]] // Sunday
      ]
        
];







foreach ($locations as $id => $name) {
  $count = fakeCount($hour,$day, $name);
  //echo "Debug: $name (day=$day, hour=$hour)<br>";
  $sql = "INSERT INTO population (location_id, count) VALUES ($id, $count)";
  $conn->query($sql);
  //echo "Inserted $count for $name<br>";
}

$conn->close();
?>
